<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head profile="http://gmpg.org/xfn/11">
<title>Las notas de Barcenas #AdoptaUnCorrupto</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta name="description" content="archiving thoughts and images" />
<link rel="alternate" type="application/rss+xml" href="http://numeroteca.org/feed/" title="numeroteca Posts RSS feed" />
<link rel="alternate" type="application/rss+xml" href="http://numeroteca.org/comments/feed/" title="numeroteca Comments RSS feed" />
<link rel="pingback" href="http://numeroteca.org/xmlrpc.php" />


<!-- Simple Google Analytics Begin -->
<script type="text/javascript">
var _gaq = [['_setAccount','UA-26717728-1'],['_trackPageview']];(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>
<!-- Simple Google Analytics End -->
<!-- *** WP-Piwik - see http://wordpress.org/extend/plugins/wp-piwik/ ******** -->
<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u=(("https:" == document.location.protocol) ? "https" : "http") + "://montera34.com/piwik/"
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 2]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
    g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Piwik Code -->
<!-- *** /WP-Piwik *********************************************************** -->
    <!--[if lte IE 8]>
		<link rel="stylesheet" type="text/css" href="http://numeroteca.org/wp-content/themes/numeroteca/css/ie.css" />
		<script src="http://ie8-js.googlecode.com/svn/version/2.0(beta3)/IE8.js" type="text/javascript"></script>
    <![endif]-->
    <!--[if IE 6]>
		<link rel="stylesheet" type="text/css" href="http://numeroteca.org/wp-content/themes/numeroteca/css/ie6.css" />
		<script src="http://ie6-js.googlecode.com/svn/version/2.0(beta3)/IE6.js" type="text/javascript"></script>
    <![endif]-->


<meta charset="utf-8">
<style>

body {
  font: 10px sans-serif;
}

path {
	stroke: steelblue;
	stroke-width: 1;
	fill: none;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}
line.years  {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
  stroke-width:5;
}
line.donaciones  {
  fill: none;
  stroke: #ccc;
  shape-rendering: crispEdges;
}
line.donaciones:hover  {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
  stroke-width:4;
}
.yearbar {
 
}

.bar {
  fill: steelblue;
}

.x.axis path {
  display: none;
}

.bar.positive {
  fill: steelblue;
}

.bar.negative {
  fill: brown;
}

.bar:hover {
  fill: black;
}

div.tooltip {   
  position: absolute;           
  /*text-align: center;      */     
  width: 150px;                
  /*height: 28px;      */             
  padding: 8px;             
  font: 12px sans-serif;        
  background: #ddd;   
  border: 0px;      
  border-radius: 4px;           
  pointer-events: none;         
}
</style>
</head>
<body>
<h1>Entradas y salidas de dinero de las notas de Bárcenas sobre la contabilidad b del PP</h1>
<p>Datos de #AdoptaUnCorrupto <a href="http://bit.ly/notasbarcenas">http://bit.ly/notasbarcenas</a> (El País y El Mundo).<br>
Pasa el rat&oacute;n por el gr&aacute;fico y descubre qui&eacute;n hay detr&aacute;s de cada entrada o salida de dinero.</p>
<script src="js/d3.v3.min.js"></script>
<script>

var margin = {top: 20, right: 20, bottom: 30, left: 60},
    width = 1900 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var formatComma = d3.format(",");
var barwidth = 2;
var baseyears = 470;
var widthyears = 5;

var xValue = function(d) { return d.fecha; }, // data -> value
    //xScale = d3.scale.ordinal().rangeRoundBands([0, width], .0), // value -> display
	xScale = d3.scale.linear(), // value -> display
    xMap = function(d) { return xScale(xValue(d)); }, // data -> display
    xAxis = d3.svg.axis().scale(xScale).orient("bottom");

var yValue = function(d) { return d.saldocalculado; }, // data -> value
    yScale = d3.scale.linear()
	.range([height, 0]), // value -> display
    yMap = function(d) { return yScale(yValue(d)); }, // data -> display
    yAxis = d3.svg.axis().scale(yScale).orient("left").tickFormat(formatComma);


		var line = d3.svg.line()
			// assign the X function to plot our line as we wish
			.x(function(d,i) { return i * 2;})
			.y(function(d) { return yScale(d.saldocalculado);})

var div = d3.select("body").append("div")   
    .attr("class", "tooltip")               
    .style("opacity", 0);	
	
var yearrect = d3.select("body").append("yearrect")   
    .attr("class", "yearbar")               
    .style("opacity", 0);

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


var imgs = svg.selectAll("image").data([0]);
                imgs.enter()
                .append("svg:image")
                .attr("xlink:href", "img/leyenda-1.png")
                .attr("x", "60")
                .attr("y", "60")
                .attr("width", "250")
                .attr("height", "301");

d3.tsv("data/data.tsv", type, function(error, data) {
  xScale.domain(data.map(xValue)); 
  yScale.domain(d3.extent(data, function(d) { return d.entradas; })).nice();

  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);

   svg.append('line')
            .attr('y1', yScale(60000))
            .attr('y2', yScale(60000))
            .attr('x1', 0)
            .attr('x2', 573*barwidth)
	    .attr("class", "donaciones")
	    .on("mouseover", function(d) {      
            div.transition()        
                .duration(200)      
                .style("opacity", .9);      
            div.html("Limite Donaciones 60.000€" )  
                .style("left", (d3.event.pageX) + "px")     
                .style("top", (d3.event.pageY) - 60 + "px");    
            })                  
        .on("mouseout", function(d) {       
            div.transition()        
                .duration(500)      
                .style("opacity", 0);   
        });
   svg.append('line')
            .attr('y1', yScale(100000))
            .attr('y2', yScale(100000))
            .attr('x1', 573*barwidth)
            .attr('x2', 624*barwidth)
	    .attr("class", "donaciones")
	    .on("mouseover", function(d) {      
            div.transition()        
                .duration(200)      
                .style("opacity", .9);      
            div.html("Limite Donaciones 100.000€" )  
                .style("left", (d3.event.pageX) + "px")     
                .style("top", (d3.event.pageY) - 60 + "px");    
            })                  
        .on("mouseout", function(d) {       
            div.transition()        
                .duration(500)      
                .style("opacity", 0);   
        });
svg.append('line')
            .attr('y1', yScale(-60000))
            .attr('y2', yScale(-60000))
            .attr('x1', 0)
            .attr('x2', 573*barwidth)
	    .attr("class", "donaciones")
	    .on("mouseover", function(d) {      
            div.transition()        
                .duration(200)      
                .style("opacity", .9);      
            div.html("Limite Donaciones 60.000€" )  
                .style("left", (d3.event.pageX) + "px")     
                .style("top", (d3.event.pageY) +20 + "px");    
            })                  
        .on("mouseout", function(d) {       
            div.transition()        
                .duration(500)      
                .style("opacity", 0);   
        });
   svg.append('line')
            .attr('y1', yScale(-100000))
            .attr('y2', yScale(-100000))
            .attr('x1', 573*barwidth)
            .attr('x2', 624*barwidth)
	    .attr("class", "donaciones")
	    .on("mouseover", function(d) {      
            div.transition()        
                .duration(200)      
                .style("opacity", .9);      
            div.html("Limite Donaciones 100.000€" )  
                .style("left", (d3.event.pageX) + "px")     
                .style("top", (d3.event.pageY) +20 + "px");    
            })                  
		.on("mouseout", function(d) {       
		    div.transition()        
		        .duration(500)      
		        .style("opacity", 0);   
		});
//years------------------
	svg.append('line')
            .attr('y1', baseyears)
            .attr('y2', baseyears)
            .attr('x1', 0*barwidth)
            .attr('x2', 19*barwidth)
	    .attr("class", "years")
	.on("mouseover", function(d) {      
            div.transition()        
                .duration(200)      
                .style("opacity", .9);      
            div.html("1991" )  
                .style("left", (d3.event.pageX) + "px")     
                .style("top", (d3.event.pageY) - 50 + "px");
	    yearrect.append('rect')
		.attr("x", 0*barwidth)
		.attr("width", 19*barwidth)
    		.attr("y", 0)
      		.attr("height", height);
			    
            })
	.on("mouseout", function(d) {       
		svg.select('.yearbar')   
			.style("opacity", 0);  
		div.transition()        
		       	.duration(500)      
		        .style("opacity", 0);
		});
	svg.append('line')
            .attr('y1', baseyears+widthyears)
            .attr('y2', baseyears+widthyears)
            .attr('x1', 19*barwidth)
            .attr('x2', 46*barwidth)
	    .attr("class", "years");
	svg.append('line')
            .attr('y1', baseyears)
            .attr('y2', baseyears)
            .attr('x1', 46*barwidth)
            .attr('x2', 85*barwidth)
	    .attr("class", "years");
	svg.append('line')
            .attr('y1', baseyears+widthyears)
            .attr('y2', baseyears+widthyears)
            .attr('x1', 85*barwidth)
            .attr('x2', 126*barwidth)
	    .attr("class", "years");
	svg.append('line')
            .attr('y1', baseyears)
            .attr('y2', baseyears)
            .attr('x1', 126*barwidth)
            .attr('x2', 175*barwidth)
	    .attr("class", "years");
	svg.append('line')
            .attr('y1', baseyears+widthyears)
            .attr('y2', baseyears+widthyears)
            .attr('x1', 175*barwidth)
            .attr('x2', 224*barwidth)
	    .attr("class", "years");
	svg.append('line')
            .attr('y1', baseyears)
            .attr('y2', baseyears)
            .attr('x1', 224*barwidth)
            .attr('x2', 248*barwidth)
	    .attr("class", "years");
	svg.append('line')
            .attr('y1', baseyears+widthyears)
            .attr('y2', baseyears+widthyears)
            .attr('x1', 248*barwidth)
            .attr('x2', 270*barwidth)
	    .attr("class", "years");

	svg.append('line')
            .attr('y1', baseyears)
            .attr('y2', baseyears)
            .attr('x1', 270*barwidth)
            .attr('x2', 292*barwidth)
	    .attr("class", "years");
	svg.append('line')
            .attr('y1', baseyears+widthyears)
            .attr('y2', baseyears+widthyears)
            .attr('x1', 292*barwidth)
            .attr('x2', 312*barwidth)
	    .attr("class", "years");

	svg.append('line')
            .attr('y1', baseyears)
            .attr('y2', baseyears)
            .attr('x1', 224*barwidth)
            .attr('x2', 248*barwidth)
	    .attr("class", "years");
	svg.append('line')
            .attr('y1', baseyears+widthyears)
            .attr('y2', baseyears+widthyears)
            .attr('x1', 248*barwidth)
            .attr('x2', 270*barwidth)
	    .attr("class", "years");


  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Euros");

  svg.selectAll(".bar")
      .data(data)
    .enter().append("rect")
      .attr("class", function(d) { return d.entradas < 0 ? "bar negative" : "bar positive"; })
     // .attr("title", function(d) { return d.persona;  })
      .attr("x", function(d, i) { return i * barwidth; })
      .attr("width", 3)
      .attr("y", function(d) { return yScale(Math.max(0, d.entradas)); })
      .attr("height", function(d) { return Math.abs(yScale(d.entradas) - yScale(0)); })
	.on("mouseover", function(d) {      
            div.transition()        
                .duration(200)      
                .style("opacity", .9);      
            div.html(d.fecha + "<br/><strong/>"  + d.persona + "</strong/><br/>"  + formatComma(d.entradas) + "€ <br/>'"  + d.descripcion + "'" )  
                .style("left", (d3.event.pageX) + "px")     
                .style("top", (d3.event.pageY - 128) + "px");    
            })                  
        .on("mouseout", function(d) {       
            div.transition()        
                .duration(500)      
                .style("opacity", 0);   
        });
});

function type(d) {
  d.entradas = +d.entradas;
  d.saldo = +d.saldo;
  return d;
}

</script>
<p>Visualizaci&oacute;n por <a href="http://twitter.com/numeroteca">@numeroteca</a>. Puedes reutilizar y mejorar esta visualizaci&oacute;n (c&oacute;digo disponible) en <a href="http://github.com/numeroteca/notabarcenas">http://github.com/numeroteca/notasbarcenas</a></p>
</body>
